<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Quick Start Guide | Kuby</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Quick Start Guide | Kuby"><meta data-react-helmet="true" name="description" content="Getting your Rails app set up to work with Kuby is pretty straightforward. Here&#x27;s a quick overview of the necessary steps:"><meta data-react-helmet="true" property="og:description" content="Getting your Rails app set up to work with Kuby is pretty straightforward. Here&#x27;s a quick overview of the necessary steps:"><meta data-react-helmet="true" property="og:url" content="https://getkuby.io/docs/"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://getkuby.io/docs/"><link rel="stylesheet" href="/styles.4aa7e576.css">
<link rel="preload" href="/styles.e901e3e9.js" as="script">
<link rel="preload" href="/runtime~main.722e9a44.js" as="script">
<link rel="preload" href="/main.995228f1.js" as="script">
<link rel="preload" href="/1.078bb1c1.js" as="script">
<link rel="preload" href="/2.35668131.js" as="script">
<link rel="preload" href="/3.7235b348.js" as="script">
<link rel="preload" href="/1be78505.ac2d2eda.js" as="script">
<link rel="preload" href="/39.7cf4aff9.js" as="script">
<link rel="preload" href="/935f2afb.9432fe37.js" as="script">
<link rel="preload" href="/17896441.64210d99.js" as="script">
<link rel="preload" href="/1690e16e.b7e0e111.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Kuby Logo"><strong class="navbar__title">Kuby</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a href="https://github.com/getkuby/kuby-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Kuby Logo"><strong class="navbar__title">Kuby</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/getkuby/kuby-core" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/raison-detre">Raison d&#x27;Etre</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/why">Why Docker and Kubernetes?</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/">Quick Start Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/after-the-deploy">After the Deploy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/development">Developing with Kuby [WIP]</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Customizing Kuby</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/customizing-docker-build">Customizing the Docker Build</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/customizing-kubernetes-resources">Customizing Kubernetes Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/managing-secrets">Managing Secrets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/data-stores">Managing Data Stores</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tls-certificates">TLS Certificates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/creating-plugins">Creating Your Own Plugins</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Quick Start Guide</h1></header><div class="markdown"><p>Getting your Rails app set up to work with Kuby is pretty straightforward. Here&#x27;s a quick overview of the necessary steps:</p><ol><li>Install Docker</li><li>Choose a hosting provider</li><li>Choose a Docker registry</li><li>Add the Kuby gems to your bundle</li><li>Configure Kuby</li><li>Deploy!</li></ol><p><strong>NOTE</strong>: Kuby is designed to work with Rails 5.1 and up.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="installing-docker"></a>Installing Docker<a aria-hidden="true" tabindex="-1" class="hash-link" href="#installing-docker" title="Direct link to heading">#</a></h2><p>The easiest way to install Docker for MacOS and Windows is via <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener noreferrer">Docker Desktop</a>. You will need Docker to build and push the Docker image for your application (described below).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="choosing-a-provider"></a>Choosing a Provider<a aria-hidden="true" tabindex="-1" class="hash-link" href="#choosing-a-provider" title="Direct link to heading">#</a></h2><p>The first step in deploying your app is to choose a hosting provider. At the time of this writing, Kuby supports <a href="https://github.com/getkuby/kuby-digitalocean" target="_blank" rel="noopener noreferrer">DigitalOcean</a>, <a href="https://github.com/getkuby/kuby-linode" target="_blank" rel="noopener noreferrer">Linode</a>, <a href="https://github.com/getkuby/kuby-azure" target="_blank" rel="noopener noreferrer">Azure</a>, and Amazon&#x27;s <a href="https://github.com/getkuby/kuby-eks" target="_blank" rel="noopener noreferrer">EKS</a>. Use your provider&#x27;s dashboard to spin up a Kubernetes cluster. In most cases, this shouldn&#x27;t involve more than a few button clicks, although for more customizable providers like EKS and Azure you might want to look for specific guides online.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="choosing-a-docker-registry"></a>Choosing a Docker Registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#choosing-a-docker-registry" title="Direct link to heading">#</a></h2><p>Kuby uses Docker to package up your application into a Docker <em>image</em>. Images are then pushed (i.e. uploaded) to something called a &quot;registry.&quot; Registries host Docker images so they can be pulled (i.e. downloaded) by the servers that will eventually run them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="docker-hub"></a>Docker Hub<a aria-hidden="true" tabindex="-1" class="hash-link" href="#docker-hub" title="Direct link to heading">#</a></h3><p>There are a number of Docker registries available, some free and some paid. Docker&#x27;s own offering is called <a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub</a>, the de-facto registry for open-source projects and commercial solutions alike. Images hosted on Docker Hub are referred to using an abbreviated URL without a hostname, i.e. <code>&lt;username&gt;/&lt;repo&gt;</code>. If you see an image referred to like this, it means it&#x27;s hosted on Docker Hub.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="gitlab"></a>Gitlab<a aria-hidden="true" tabindex="-1" class="hash-link" href="#gitlab" title="Direct link to heading">#</a></h3><p>Gitlab&#x27;s Docker registry is a great alternative to Docker Hub. It&#x27;s free and unlimited. Oh, and a quick note: you don&#x27;t have to host your code on Gitlab to take advantage of the registry, but they&#x27;re great for that too.</p><p>Images hosted on 3rd-party registries (i.e. not on Docker Hub) are referred to by their full URL. If you choose to use Gitlab&#x27;s Docker registry, the URL to your Docker image will look like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">registry.gitlab.com/&lt;username&gt;/&lt;repo&gt;</span></div></div></div></div></div><p><strong>NOTE</strong>: Gitlab&#x27;s Docker registry requires you to authenticate using a personal or deploy access token instead of your Gitlab password. See their <a href="https://docs.gitlab.com/ee/user/packages/container_registry/#authenticate-with-the-container-registry" target="_blank" rel="noopener noreferrer">documentation</a> for more information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="github"></a>Github<a aria-hidden="true" tabindex="-1" class="hash-link" href="#github" title="Direct link to heading">#</a></h2><p>Github runs a docker registry, available at docker.pkg.github.com. As with Gitlab, you&#x27;ll need to refer to the registry using the full URL; Github also requires that the image is tagged with the format <code>:username/:repo/:image_name</code>, so your URL will look something like</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">docker.pkg.github.com/&lt;username&gt;/&lt;repo&gt;/&lt;image-name&gt;</span></div></div></div></div></div><p>You&#x27;ll also need to get Docker to log in to the registry using a token with the correct access permissions; you can find out more in <a href="https://docs.github.com/articles/configuring-docker-for-use-with-github-package-registry/" target="_blank" rel="noopener noreferrer">the Github package documenation</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="adding-kuby-to-your-bundle"></a>Adding Kuby to your Bundle<a aria-hidden="true" tabindex="-1" class="hash-link" href="#adding-kuby-to-your-bundle" title="Direct link to heading">#</a></h2><p>Add the kuby-core gem and the corresponding gem for your chosen provider to your Rails application&#x27;s Gemfile, for example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">gem &#x27;kuby-core&#x27;, &#x27;&lt; 1.0&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">gem &#x27;kuby-digitalocean&#x27;, &#x27;&lt; 1.0&#x27;</span></div></div></div></div></div><p>Run <code>bundle install</code> to install the gems.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-kuby"></a>Configuring Kuby<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-kuby" title="Direct link to heading">#</a></h2><p>All Kuby configuration is written in Ruby and lives in a file called kuby.rb in your application&#x27;s root directory.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-the-rails-generator"></a>Using the Rails Generator<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-the-rails-generator" title="Direct link to heading">#</a></h3><p>Rather than follow all the steps below, feel free to make use of Kuby&#x27;s Rails generator, which will create all the files you need and put them in the right places. Just run</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">bundle exec rails generate kuby</span></div></div></div></div></div><p>and follow the prompts.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="manual-configuration"></a>Manual Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#manual-configuration" title="Direct link to heading">#</a></h3><p>Kuby configuration is done via a <a href="https://en.wikipedia.org/wiki/Domain-specific_language" target="_blank" rel="noopener noreferrer">DSL</a>. There are two main sections, one for Docker and one for Kubernetes. Put the config into a file called kuby.rb in the root directory of your Rails app.</p><p>Here&#x27;s what a complete config looks like:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">require &#x27;active_support/core_ext&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">require &#x27;active_support/encrypted_configuration&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Kuby.define(&#x27;my-app&#x27;) do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  app_creds = ActiveSupport::EncryptedConfiguration.new(</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    config_path: File.join(&#x27;config&#x27;, &#x27;credentials.yml.enc&#x27;),</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    key_path: File.join(&#x27;config&#x27;, &#x27;master.key&#x27;),</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    env_key: &#x27;RAILS_MASTER_KEY&#x27;,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    raise_if_missing_key: true</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  )</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  environment(:production) do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    docker do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      credentials do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        username app_creds[:DOCKER_USERNAME]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        password app_creds[:DOCKER_PASSWORD]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        email app_creds[:DOCKER_EMAIL]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      image_url &#x27;registry.gitlab.com/username/repo&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    kubernetes do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      provider :digitalocean do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        access_token app_creds[:DIGITALOCEAN_ACCESS_TOKEN]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        cluster_id &#x27;aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      add_plugin :rails_app do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        hostname &#x27;mywebsite.com&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        database do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">          user app_creds[:DB_USER]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">          password app_creds[:DB_PASSWORD]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">end</span></div></div></div></div></div><p>Create a Rails initializer at config/initializers/kuby.rb that loads your Kuby config:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">require &#x27;kuby&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Kuby.load!</span></div></div></div></div></div><p>Let&#x27;s go over this config in detail.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploy-environments"></a>Deploy Environments<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-environments" title="Direct link to heading">#</a></h3><p>The first line tells Kuby what you want to call your app:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">Kuby.define(&#x27;my-app&#x27;)</span></div></div></div></div></div><p><strong>NOTE</strong>: The next block loads your Rails credentials file. Since your Rails environment may or may not be loaded when your Kuby config loads, we have to access Rails credentials manually.</p><p>The second line defines the <em>deploy environment</em>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">environment(:production)</span></div></div></div></div></div><p>Deploy environments usually closely mirror your Rails environments. For example, you might create a new Rails environment called &quot;staging&quot; or &quot;preprod&quot; that&#x27;s used to test production changes before they go live.</p><p>If you&#x27;re a small shop or hobbyist though, chances are the &quot;production&quot; deploy environment is all you need.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-docker"></a>Configuring Docker<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-docker" title="Direct link to heading">#</a></h3><p>Kuby can automatically &quot;dockerize&quot; your application. You just need to tell it where to push images and provide some credentials:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">docker do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  credentials do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    username app_creds[:DOCKER_USERNAME]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    password app_creds[:DOCKER_PASSWORD]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    email app_creds[:DOCKER_EMAIL]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  image_url &#x27;registry.gitlab.com/username/repo&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">end</span></div></div></div></div></div><p>The username, password, and email fields are used to authenticate with the Docker registry that hosts your images. For Gitlab, you&#x27;ll need to create a <a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html" target="_blank" rel="noopener noreferrer">personal access token</a> instead of your password. The <code>image_url</code> field is the full URL to your image, including the registry&#x27;s domain.</p><p>In the example above, the username, password, and email are all provided by Rails&#x27; <a href="https://guides.rubyonrails.org/v5.2/security.html#custom-credentials" target="_blank" rel="noopener noreferrer">encrypted credentials</a> feature. It&#x27;s important to remember to <strong>NEVER</strong> hard-code sensitive information (like passwords) in your Kuby config or check it into source control (i.e. git). If you&#x27;d rather not use encrypted credentials, consider using a tool like <a href="https://github.com/bkeepers/dotenv" target="_blank" rel="noopener noreferrer">dotenv</a> to automatically load your secrets into environment variables when your app starts (NOTE: don&#x27;t check the .env file into git either!)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuring-kubernetes"></a>Configuring Kubernetes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuring-kubernetes" title="Direct link to heading">#</a></h3><p>Now that your app can be packaged up into a Docker image, it&#x27;s time to use Kubernetes to run it. There are two top-level concerns in the Kubernetes section of your Kuby config: providers and plugins.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="providers"></a>Providers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#providers" title="Direct link to heading">#</a></h4><p>Each Kubernetes definition must have a provider configured. Providers correspond to the hosting provider you chose earlier. For example, you&#x27;ll need to add the <code>:digitalocean</code> provider to deploy to a managed DigitalOcean Kubernetes cluster.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">kubernetes do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  provider :digitalocean do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    access_token app_creds[:DIGITALOCEAN_ACCESS_TOKEN]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    cluster_id &#x27;aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">end</span></div></div></div></div></div><p>Providers can have different config options, so make sure you consult the gem&#x27;s README for the provider you&#x27;ve chosen.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="plugins"></a>Plugins<a aria-hidden="true" tabindex="-1" class="hash-link" href="#plugins" title="Direct link to heading">#</a></h4><p>Nearly all Kuby&#x27;s functionality is provided via plugins. For example, simply add the <code>:rails_app</code> plugin to get your Rails app ready to deploy:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">add_plugin :rails_app</span></div></div></div></div></div><p>To indicate your app serves a particular domain name, specify the <code>hostname</code> option:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">add_plugin :rails_app do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  hostname &#x27;mywebsite.com&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">end</span></div></div></div></div></div><p>Configuring DNS to point to your Kubernetes cluster is outside the scope of this guide, but all the hosting providers should have tutorials readily available. For example, <a href="https://www.digitalocean.com/community/tutorials/how-to-point-to-digitalocean-nameservers-from-common-domain-registrars" target="_blank" rel="noopener noreferrer">here&#x27;s the one</a> from DigitalOcean.</p><p>Finally, specify your database credentials:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-ruby codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">add_plugin(:rails_app) do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  hostname &#x27;mywebsite.com&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  database do</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    user app_creds[:DB_USER]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    password app_creds[:DB_PASSWORD]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  end</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">end</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="deploying"></a>Deploying<a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploying" title="Direct link to heading">#</a></h2><p>Now that Kuby is configured and your Kubernetes cluster is ready, it&#x27;s time to deploy!</p><ol><li><p>Build the Docker image</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">bundle exec kuby -e production build</span></div></div></div></div></div></li><li><p>Push the Docker image to the container registry</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">bundle exec kuby -e production push</span></div></div></div></div></div></li><li><p>Set up your provider</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">bundle exec kuby -e production setup</span></div></div></div></div></div></li><li><p>Deploy!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">RAILS_MASTER_KEY=&lt;your master key&gt; bundle exec kuby -e production deploy</span></div></div></div></div></div></li><li><p>Rejoice</p></li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/getkuby/kuby-core/edit/master/docs/docs/quick_start_guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/why"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Why Docker and Kubernetes?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/after-the-deploy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">After the Deploy »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installing-docker" class="table-of-contents__link">Installing Docker</a></li><li><a href="#choosing-a-provider" class="table-of-contents__link">Choosing a Provider</a></li><li><a href="#choosing-a-docker-registry" class="table-of-contents__link">Choosing a Docker Registry</a><ul><li><a href="#docker-hub" class="table-of-contents__link">Docker Hub</a></li><li><a href="#gitlab" class="table-of-contents__link">Gitlab</a></li></ul></li><li><a href="#github" class="table-of-contents__link">Github</a></li><li><a href="#adding-kuby-to-your-bundle" class="table-of-contents__link">Adding Kuby to your Bundle</a></li><li><a href="#configuring-kuby" class="table-of-contents__link">Configuring Kuby</a><ul><li><a href="#using-the-rails-generator" class="table-of-contents__link">Using the Rails Generator</a></li><li><a href="#manual-configuration" class="table-of-contents__link">Manual Configuration</a></li><li><a href="#deploy-environments" class="table-of-contents__link">Deploy Environments</a></li><li><a href="#configuring-docker" class="table-of-contents__link">Configuring Docker</a></li><li><a href="#configuring-kubernetes" class="table-of-contents__link">Configuring Kubernetes</a></li></ul></li><li><a href="#deploying" class="table-of-contents__link">Deploying</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Quick Start Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/why">Why Docker and Kubernetes?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getkuby" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/camertron" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 @camertron. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.e901e3e9.js"></script>
<script src="/runtime~main.722e9a44.js"></script>
<script src="/main.995228f1.js"></script>
<script src="/1.078bb1c1.js"></script>
<script src="/2.35668131.js"></script>
<script src="/3.7235b348.js"></script>
<script src="/1be78505.ac2d2eda.js"></script>
<script src="/39.7cf4aff9.js"></script>
<script src="/935f2afb.9432fe37.js"></script>
<script src="/17896441.64210d99.js"></script>
<script src="/1690e16e.b7e0e111.js"></script>
</body>
</html>